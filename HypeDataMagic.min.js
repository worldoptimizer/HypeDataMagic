/*
 Hype DataMagic (Core) 1.2
copyright (c) 2020 Max Ziebell, (https://maxziebell.de). MIT-license
*/
!1==="HypeDataMagic"in window&&(window.HypeDataMagic=function(){function z(a,b,c){if(c.handler&&"object"==typeof h[c.handler])if("function"==typeof h[c.handler][c.type])try{h[c.handler][c.type](a,b,c)}catch(d){console.log('There was an error in your handler "'+c.handler+'": ',d)}else if(r&&"function"==typeof h[c.handler].DataMagicPrepareForDisplay)try{h[c.handler].DataMagicPrepareForDisplay(a,b,c)}catch(d){console.log('There was an error in your handler "'+c.handler+'": ',d)}}function p(a,b,c){if(b.getAttribute("data-magic-key")){var d=
w(b,"data-magic-source")||g.source,e=A(b.getAttribute("data-magic-key")),f="customData"==d?a.customData:B(d);if(f){var k=w(b,"data-magic-branch");f=k?C(a,f,k):f;f=C(a,f,e);console.log(f);if(null!=f){if("object"!=typeof f){k=b.getAttribute("data-magic-prefix")||"";var l=b.getAttribute("data-magic-append")||"";f=k+f+l}c=Object.assign(c||{},{data:f,source:d,key:e});d=c.type?c.type.replace("HypeScene","DataMagic").split():r?["DataMagicPreviewUpdate"]:["DataMagicPrepareForDisplay","DataMagicLoad"];var H=
(b.getAttribute("data-magic-handler")||f.handler||"text").split(",");d.forEach(function(I){H.forEach(function(J){z(a,b,Object.assign(c,{type:I,handler:J.trim()}))})})}else t(a,b)}}}function t(a,b,c){c=c||{};c.type||(c.type="DataMagicUnload");c.handler=c.oldHandler||b.getAttribute("data-magic-handler")||"text";z(a,b,c)}function D(a){a.setAttribute("magic-rebuild-time",Math.floor(performance.now()))}function E(a,b){q[a.documentId()]||(q[a.documentId()]={changeObserver:new MutationObserver(function(c){c.forEach(function(d){if("attributes"==
d.type){var e=d.target,f=d.attributeName,k=A(e.getAttribute(f));d=d.oldValue;if(k!=d){var l;if(l=r)l=(l=e.getAttribute("magic-rebuild-time"))?100>performance.now()-parseInt(l):!1;if(!l)switch(f){case "data-magic-key":k?p(a,e):t(a,e);break;case "data-magic-source":case "data-magic-branch":t(a,e);m(a,e);break;case "data-magic-handler":t(a,e,{oldHandler:d}),m(a,e)}}}})}),options:{subtree:!0,attributes:!0,attributeFilter:["data-magic-key","data-magic-source","data-magic-branch","data-magic-handler"],
attributeOldValue:!0},enable:function(){this.changeObserver.observe(b,this.options)},disable:function(){this.changeObserver.disconnect()}})}function u(a){q[a.documentId()]&&q[a.documentId()].enable()}function x(a){q[a.documentId()]&&q[a.documentId()].disable()}function F(a,b,c){b&&b.querySelectorAll("[data-magic-key]").forEach(function(d){p(a,d,c)})}function m(a,b,c){b&&(b&&p(a,b,c),F(a,b,c))}function B(a){return g.sourceRedirect[a]?v[g.sourceRedirect[a]]||null:a?v[a]||null:v[g.source]||null}function A(a){if("string"==
typeof a)return a.trim()}function C(a,b,c){if("object"==typeof b&&"string"==typeof c){c=c.replace(/\[(\d+)\]/g,function(f,k){return"."+parseInt(k)});c=c.replace(/^\./,"");a=c.split(".");for(var d=0,e=a.length;d<e;++d){if("object"!=typeof b)return;c=a[d];if(!b.hasOwnProperty(c))return;b=b[c]}return b}}function w(a,b){if(!a||!a.id)return null;for(;a.parentNode&&!a.classList.contains("HYPE_scene");){if(a.hasAttribute(b))return a.getAttribute(b);a=a.parentNode}return null}function G(a,b,c){a.refresh=
function(d){m(this,d||document.getElementById(this.currentSceneId()))};a.refreshDescendants=function(d){F(this,d||document.getElementById(this.currentSceneId()))};a.refreshElement=function(d){d&&p(this,d,void 0)};a.disableChangeObserver=function(){x(this)};a.enableChangeObserver=function(){u(this)};a.setContentIfNecessary=function(d,e){d.innerHTML!=e&&(d.innerHTML=e)};r||(E(a,b),u(a))}var r=-1!=window.location.href.indexOf("/Hype/Scratch/HypeScratch."),v={},q={},y=[],g={source:"shared",fallbackImage:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="},
fetchResponseCallback:function(a){return a.json()},fetchErrorCallback:function(a,b){},fetchDataCallback:function(a,b){},handlerMixin:{},sourceRedirect:{},customDataForPreview:{}},h={text:{DataMagicPrepareForDisplay:function(a,b,c){b.innerHTML!=c.data&&(b.innerHTML=c.data)},DataMagicUnload:function(a,b,c){b.querySelectorAll(".HYPE_element, .HYPE_element_container").length||(b.innerHTML="")}},image:{DataMagicPrepareForDisplay:function(a,b,c){"string"==typeof c.data&&(c.data={src:c.data});c.data.src||
(c.data.src=b.dataset.fallbackImage||g.fallbackImage());b.innerHTML="";a.getElementProperty(b,"background-image")!=c.data.src&&(b.style.backgroundRepeat="no-repeat",b.style.backgroundPosition=c.data.backgroundPosition||b.dataset.backgroundPosition||"center center",b.style.backgroundSize=c.data.backgroundSize||b.dataset.backgroundSize||"contain",a.setElementProperty(b,"background-image",c.data.src))},DataMagicUnload:function(a,b,c){a.setElementProperty(b,"background-image","");b.style.backgroundRepeat=
b.style.backgroundPosition=""}}};!1==="HYPE_eventListeners"in window&&(window.HYPE_eventListeners=[]);window.HYPE_eventListeners.push({type:"HypeDocumentLoad",callback:G});window.HYPE_eventListeners.push({type:"HypeScenePrepareForDisplay",callback:function(a,b,c){x(a);m(a,b,c)}});window.HYPE_eventListeners.push({type:"HypeSceneLoad",callback:function(a,b,c){m(a,b,c);y&&(y.forEach(function(d){d()}),y=null);u(a)}});window.HYPE_eventListeners.push({type:"HypeSceneUnload",callback:function(a,b,c){x(a)}});
if(r){var n=new Proxy({getElementProperty:function(a,b){return a.style.getPropertyValue(b)||null},setElementProperty:function(a,b,c){if(c)switch(b){case "background-image":c="url("+c+")"}a.style.setProperty(b,c,"important")},documentId:function(){return"HypeSceneEditor"}},{get:function(a,b){return"customData"===b?g.customDataForPreview:a[b]}});G(n,document.documentElement);(new MutationObserver(function(a){a.forEach(function(b){var c=b.target;"attributes"===b.type&&c.parentNode&&"contenteditable"==
b.attributeName&&(c.parentNode.hasAttribute("data-magic-key")?"false"==c.getAttribute("contenteditable")&&"true"==b.oldValue?setTimeout(function(){c.parentNode.removeAttribute("magic-edit");D(c.parentNode);var d=c.parentNode;d&&p(n,d,void 0)},1):(c.parentNode.setAttribute("magic-edit","preview"),setTimeout(function(){var d=w(c.parentNode,"data-magic-branch"),e="\x3c!-- Hype Data magic: This is only a preview placeholder and edits are ignored!";d&&(e+=' This key resides on the branch "'+d+'"');c.innerHTML=
e+" --\x3e\n"+c.parentNode.getAttribute("data-magic-key")},1)):c.parentNode.querySelectorAll("[data-magic-key]").length&&("false"==c.getAttribute("contenteditable")&&"true"==b.oldValue?setTimeout(function(){c.parentNode.removeAttribute("magic-edit");c.parentNode.querySelectorAll("[data-magic-key]").forEach(function(d){D(d);d&&p(n,d,void 0)})},1):(c.parentNode.setAttribute("magic-edit","innerHTML"),setTimeout(function(){c.parentNode.querySelectorAll("[data-magic-key]").forEach(function(d){d.removeAttribute("magic-rebuild-time");
d.innerHTML=d.getAttribute("data-magic-key")})},1))))})})).observe(document.documentElement,{attributes:!0,attributeOldValue:!0,attributeFilter:["contenteditable"],subtree:!0});window.addEventListener("DOMContentLoaded",function(a){document.addEventListener("focusout",function(b){b.target.parentNode.hasAttribute("magic-edit")&&b.target.hasAttribute("contenteditable")&&(b.target.parentNode.hasAttribute("data-magic-key")?b.target&&(b.target.innerHTML=""):"innerHTML"==b.target.parentNode.getAttribute("magic-edit")&&
(b=b.target.querySelectorAll("[data-magic-key]"),b.length&&b.forEach(function(c){c.innerHTML=""})))});document.addEventListener("visibilitychange",function(b){document.hidden||m(n,document.documentElement)},!1);setTimeout(function(){m(n,document.documentElement);E(n,document.documentElement);u(n)},1);document.styleSheets[0].insertRule('[contenteditable="true"] [data-magic-key], [magic-edit="preview"] [contenteditable="true"]  {opacity:0.5}',0);document.styleSheets[0].insertRule('[magic-edit]::before { position:absolute; opacity:1; content: "Data Magic"; text-align: center; font-size:7px; padding:3px; height: 8px; width: 40px; color:#fff; left: -2px; top: -16px; border-radius: 1px; background-color: #75A4EA;}',
0);window.getSelection().removeAllRanges()})}return{version:"1.2",setData:function(a,b){b=b||g.source;v[b]=a},getData:B,setDefault:function(a,b){g[a]=b},getDefault:function(a){return g[a]},addDataHandler:function(a,b){if("string"!=!typeof a)switch(typeof b){case "object":h[a]=Object.assign({},g.handlerMixin,b);break;case "function":h[a]=Object.assign({},g.handlerMixin,h.text),h[a].DataMagicPrepareForDisplay=b}}}}());