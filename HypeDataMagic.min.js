/*
 Hype DataMagic (Core) 1.3.2
copyright (c) 2021 Max Ziebell, (https://maxziebell.de). MIT-license
*/
!1==="HypeDataMagic"in window&&(window.HypeDataMagic=function(){function y(b,a,c){if(c.handler&&"object"==typeof k[c.handler]){if("function"==typeof k[c.handler][c.type]){try{var d=k[c.handler][c.type](b,a,c)}catch(e){console.log('There was an error in your handler "'+c.handler+'": ',e)}return d}if(q&&"function"==typeof k[c.handler].DataMagicPrepareForDisplay){try{d=k[c.handler].DataMagicPrepareForDisplay(b,a,c)}catch(e){console.log('There was an error in your handler "'+c.handler+'": ',e)}return d}}}
function n(b,a,c){if(a.getAttribute("data-magic-key")){var d=v(a,"data-magic-source")||g.source,e=z(a.getAttribute("data-magic-key")),f="customData"==d?b.customData:A(d);if(f){var h=v(a,"data-magic-branch");f=h?B(b,f,h):f;f=B(b,f,e);if(null!=f){if("object"!=typeof f){h=a.getAttribute("data-magic-prefix");var C=a.getAttribute("data-magic-append");if(h||C)f=h+f+C}c=Object.assign({},c,{data:f,source:d,key:e});d=c.type?c.type.replace("HypeScene","DataMagic").split():q?["DataMagicPreviewUpdate"]:["DataMagicPrepareForDisplay",
"DataMagicLoad"];var I=(a.getAttribute("data-magic-handler")||"text").split(",");d.forEach(function(J){var D;I.forEach(function(K){D=y(b,a,Object.assign({},c,D,{type:J,handler:K.trim()}))})})}else r(b,a)}}}function r(b,a,c){c=Object.assign({},c);handlers=(c.oldHandler||a.getAttribute("data-magic-handler")||"text").split(",");var d;handlers.forEach(function(e){d=y(b,a,Object.assign({},c,d,{type:"DataMagicUnload",handler:e.trim()}))})}function E(b){return!b.querySelectorAll(".HYPE_element, .HYPE_element_container").length}
function F(b,a){p[b.documentId()]||(p[b.documentId()]={changeObserver:new MutationObserver(function(c){c.forEach(function(d){if("attributes"==d.type){var e=d.target,f=d.attributeName,h=z(e.getAttribute(f));d=d.oldValue;if(h!=d)switch(f){case "data-magic-key":h?n(b,e):r(b,e);break;case "data-magic-source":case "data-magic-branch":r(b,e);l(b,e);break;case "data-magic-handler":r(b,e,{oldHandler:d});l(b,e);break;case "data-magic-prefix":case "data-magic-append":l(b,e)}}})}),options:{subtree:!0,attributes:!0,
attributeFilter:"data-magic-key data-magic-source data-magic-branch data-magic-handler data-magic-prefix data-magic-append".split(" "),attributeOldValue:!0},enable:function(){this.changeObserver.observe(a,this.options)},disable:function(){this.changeObserver.disconnect()}})}function t(b){p[b.documentId()]&&p[b.documentId()].enable()}function w(b){p[b.documentId()]&&p[b.documentId()].disable()}function G(b,a,c){a&&a.querySelectorAll("[data-magic-key]").forEach(function(d){n(b,d,c)})}function l(b,a,
c){a&&(a&&n(b,a,c),G(b,a,c))}function A(b){return g.sourceRedirect[b]?u[g.sourceRedirect[b]]||null:b?u[b]||null:u[g.source]||null}function z(b){if("string"==typeof b)return b.trim()}function B(b,a,c){if("object"==typeof a&&"string"==typeof c){c=c.replace(/\[(\d+)\]/g,function(f,h){return"."+parseInt(h)});c=c.replace(/^\./,"");b=c.split(".");for(var d=0,e=b.length;d<e;++d){if("object"!=typeof a)return;c=b[d];if(!a.hasOwnProperty(c))return;a=a[c]}return a}}function v(b,a){if(!b||!b.id)return null;for(;b.parentNode&&
!b.classList.contains("HYPE_scene");){if(b.hasAttribute(a))return b.getAttribute(a);b=b.parentNode}return null}function H(b,a,c){b.refresh=function(d){l(this,d||document.getElementById(this.currentSceneId()))};b.refreshDescendants=function(d){G(this,d||document.getElementById(this.currentSceneId()))};b.refreshElement=function(d){d&&n(this,d,void 0)};b.disableChangeObserver=function(){w(this)};b.enableChangeObserver=function(){t(this)};b.setContentIfNecessary=function(d,e){d.innerHTML!=e&&(d.innerHTML=
e)};q||(F(b,a),t(b))}var q=-1!=window.location.href.indexOf("/Hype/Scratch/HypeScratch."),u={},p={},g={source:"shared",fallbackImage:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="},handlerMixin:{},sourceRedirect:{},customDataForPreview:{}},k={text:{DataMagicPrepareForDisplay:function(b,a,c){a.innerHTML!=c.data&&E(a)&&(a.innerHTML=c.data)},DataMagicUnload:function(b,a,c){E(a)&&(a.innerHTML="")}},image:{DataMagicPrepareForDisplay:function(b,
a,c){"string"==typeof c.data&&(c.data={src:c.data});c.data.src||(c.data.src=a.dataset.fallbackImage||g.fallbackImage());a.innerHTML="";b.getElementProperty(a,"background-image")!=c.data.src&&(a.style.backgroundRepeat="no-repeat",a.style.backgroundPosition=c.data.backgroundPosition||a.dataset.backgroundPosition||"center center",a.style.backgroundSize=c.data.backgroundSize||a.dataset.backgroundSize||"contain",b.setElementProperty(a,"background-image",c.data.src))},DataMagicUnload:function(b,a,c){b.setElementProperty(a,
"background-image","");a.style.backgroundRepeat=a.style.backgroundPosition=""}}};!1==="HYPE_eventListeners"in window&&(window.HYPE_eventListeners=[]);window.HYPE_eventListeners.push({type:"HypeDocumentLoad",callback:H});window.HYPE_eventListeners.push({type:"HypeScenePrepareForDisplay",callback:function(b,a,c){w(b);l(b,a,c)}});window.HYPE_eventListeners.push({type:"HypeSceneLoad",callback:function(b,a,c){l(b,a,c);t(b)}});window.HYPE_eventListeners.push({type:"HypeSceneUnload",callback:function(b,
a,c){w(b)}});if(q){var m=new Proxy({getElementProperty:function(b,a){return b.style.getPropertyValue(a)||null},setElementProperty:function(b,a,c){if(c)switch(a){case "background-image":c="url("+c+")"}b.style.setProperty(a,c,"important")},documentId:function(){return"HypeSceneEditor"}},{get:function(b,a){return"customData"===a?g.customDataForPreview:b[a]}});H(m,document.documentElement);(new MutationObserver(function(b){b.forEach(function(a){var c=a.target;"attributes"===a.type&&c.parentNode&&"contenteditable"==
a.attributeName&&(c.parentNode.hasAttribute("data-magic-key")?"false"==c.getAttribute("contenteditable")&&"true"==a.oldValue?setTimeout(function(){c.parentNode.removeAttribute("magic-edit");var d=c.parentNode;d&&n(m,d,void 0)},1):(c.parentNode.setAttribute("magic-edit","preview"),setTimeout(function(){var d=v(c.parentNode,"data-magic-branch"),e="\x3c!-- Hype Data magic: This is only a preview placeholder and edits are ignored!";d&&(e+=' This key resides on the branch "'+d+'"');c.innerHTML=e+" --\x3e\n"+
c.parentNode.getAttribute("data-magic-key")},1)):c.parentNode.querySelectorAll("[data-magic-key]").length&&("false"==c.getAttribute("contenteditable")&&"true"==a.oldValue?setTimeout(function(){c.parentNode.removeAttribute("magic-edit");c.parentNode.querySelectorAll("[data-magic-key]").forEach(function(d){d&&n(m,d,void 0)})},1):(c.parentNode.setAttribute("magic-edit","innerHTML"),setTimeout(function(){c.parentNode.querySelectorAll("[data-magic-key]").forEach(function(d){d.innerHTML=d.getAttribute("data-magic-key")})},
1))))})})).observe(document.documentElement,{attributes:!0,attributeOldValue:!0,attributeFilter:["contenteditable"],subtree:!0});var x;(new MutationObserver(function(b){x||2==b.length&&"HypeMainContentDiv"==b[0].target.id&&(x=setTimeout(function(){x=null;l(m,document.documentElement)},1))})).observe(document.documentElement,{childList:!0,subtree:!0});_updates={};(new MutationObserver(function(b){b.forEach(function(a){var c=a.target.getAttribute(a.attributeName);if(c&&a.oldValue==c&&-1!=c.indexOf("data-magic")){var d=
a.target.getAttribute("hypeobjectid");_updates[d]||(_updates[d]=setTimeout(function(){var e=a.target;e&&n(m,e,void 0);delete _updates[d]},1))}})})).observe(document.documentElement,{attributes:!0,attributeOldValue:!0,attributeFilter:["hypeattributelastkeysplist"],subtree:!0});window.addEventListener("DOMContentLoaded",function(b){document.addEventListener("focusout",function(a){a.target.parentNode.hasAttribute("magic-edit")&&a.target.hasAttribute("contenteditable")&&(a.target.parentNode.hasAttribute("data-magic-key")?
a.target&&(a.target.innerHTML=""):"innerHTML"==a.target.parentNode.getAttribute("magic-edit")&&(a=a.target.querySelectorAll("[data-magic-key]"),a.length&&a.forEach(function(c){c.innerHTML=""})))});document.addEventListener("visibilitychange",function(a){document.hidden||l(m,document.documentElement)},!1);setTimeout(function(){l(m,document.documentElement);F(m,document.documentElement);t(m)},1);document.styleSheets[0].insertRule('[contenteditable="true"] [data-magic-key], [magic-edit="preview"] [contenteditable="true"]  {opacity:0.5}',
0);document.styleSheets[0].insertRule('[magic-edit]::before { position:absolute; opacity:1; content: "Data Magic"; text-align: center; font-size:7px; padding:3px; height: 8px; width: 40px; color:#fff; left: -2px; top: -16px; border-radius: 1px; background-color: #75A4EA;}',0);window.getSelection().removeAllRanges()})}return{version:"1.3.2",setData:function(b,a){a=a||g.source;u[a]=b},getData:A,setDefault:function(b,a){g[b]=a},getDefault:function(b){return g[b]},addDataHandler:function(b,a){if("string"!=
!typeof b)switch(typeof a){case "object":k[b]=Object.assign({},g.handlerMixin,a);break;case "function":k[b]=Object.assign({},g.handlerMixin,k.text),k[b].DataMagicPrepareForDisplay=a}}}}());
