/*
 Hype DataMagic (Core) 1.3.4
copyright (c) 2021 Max Ziebell, (https://maxziebell.de). MIT-license
*/
!1==="HypeDataMagic"in window&&(window.HypeDataMagic=function(){function C(a,b,c){if(c.handler)if("()"==c.handler.slice(-2)){if(!p&&a.functions){try{var d=a.functions()[c.handler.slice(0,-2)](a,b,c)}catch(e){console.log('There was an error in your handler "'+c.handler+'": ',e)}return d}}else if("object"==typeof h[c.handler]){if("function"==typeof h[c.handler][c.type]){try{d=h[c.handler][c.type](a,b,c)}catch(e){console.log('There was an error in your handler "'+c.handler+'": ',e)}return d}if(p&&"function"==
typeof h[c.handler].DataMagicPrepareForDisplay){try{d=h[c.handler].DataMagicPrepareForDisplay(a,b,c)}catch(e){console.log('There was an error in your handler "'+c.handler+'": ',e)}return d}}}function v(a,b,c){if(b.getAttribute("data-magic-key")){var d=w(b,"data-magic-source")||f.source,e=D(b.getAttribute("data-magic-key")),g="customData"==d?a.customData:E(d);if(g){var m=w(b,"data-magic-branch");g=m?r(g,m):g;g=r(g,e);if(null!=g){if("object"!=typeof g){m=b.getAttribute("data-magic-prefix")||"";var F=
b.getAttribute("data-magic-append")||"";if(m||F)g=m+g+F}c=Object.assign({},c,{data:g,source:d,key:e});d=c.type?c.type.replace("HypeScene","DataMagic").split():p?["DataMagicPreviewUpdate"]:["DataMagicPrepareForDisplay","DataMagicLoad"];var M=(b.getAttribute("data-magic-handler")||"text").split(",");d.forEach(function(N){var G;M.forEach(function(O){G=C(a,b,Object.assign({},c,G,{type:N,handler:O.trim()}))})})}else t(a,b)}}}function t(a,b,c){c=Object.assign({},c);handlers=(c.oldHandler||b.getAttribute("data-magic-handler")||
"text").split(",");var d;handlers.forEach(function(e){d=C(a,b,Object.assign({},c,d,{type:"DataMagicUnload",handler:e.trim()}))})}function H(a){return!a.querySelectorAll(".HYPE_element, .HYPE_element_container").length}function I(a,b){n[a.documentId()]||(n[a.documentId()]={changeObserver:new MutationObserver(function(c){c.forEach(function(d){if("attributes"==d.type){var e=d.target,g=d.attributeName,m=D(e.getAttribute(g));d=d.oldValue;if(m!=d)switch(g){case "data-magic-key":m?v(a,e):t(a,e);break;case "data-magic-source":case "data-magic-branch":t(a,
e);k(a,e);break;case "data-magic-handler":t(a,e,{oldHandler:d});k(a,e);break;case "data-magic-prefix":case "data-magic-append":k(a,e)}}})}),options:{subtree:!0,attributes:!0,attributeFilter:"data-magic-key data-magic-source data-magic-branch data-magic-handler data-magic-prefix data-magic-append".split(" "),attributeOldValue:!0},enable:function(){this.changeObserver.observe(b,this.options)},disable:function(){this.changeObserver.disconnect()}})}function u(a){n[a.documentId()]&&n[a.documentId()].enable()}
function x(a){n[a.documentId()]&&n[a.documentId()].disable()}function J(a,b,c){b&&b.querySelectorAll("[data-magic-key]").forEach(function(d){v(a,d,c);1==f.forceRedrawElement&&y(d)})}function q(a,b,c){b&&(v(a,b,c),1==f.forceRedrawElement&&y(b))}function k(a,b,c){b&&(q(a,b,c),J(a,b,c),1==f.forceRedrawDocument&&y(b))}function K(a){a&&a.hasOwnProperty("refresh")?a.refresh():window.hasOwnProperty("HYPE")&&Object.values(window.HYPE.documents).forEach(function(b){b.refresh()})}function E(a,b){if(f.sourceRedirect[a])return z[f.sourceRedirect[a]]||
null;a||(a=f.source);var c=z[a]||null;return c&&b?r(c,b):c}function D(a){if("string"==typeof a)return a.trim()}function A(a){if(Array.isArray(a))return a.reduce(function(b,c){return b.concat(A(c))},[]);if("string"==typeof a)return a=a.replace(/\[(\d+)\]/g,function(b,c){return"."+parseInt(c)}),a=a.replace(/^\./,""),a.split(".")}function r(a,b){if("object"==typeof a){var c=A(b);if(c)return c.reduce(function(d,e){return d&&d.hasOwnProperty(e)?d[e]:null},a)}}function w(a,b){if(!a||!a.id)return null;for(;a.parentNode&&
!a.classList.contains("HYPE_scene");){if(a.hasAttribute(b))return a.getAttribute(b);a=a.parentNode}return null}function L(a,b,c){a.refresh=function(d){k(this,d||document.getElementById(this.currentSceneId()))};a.refreshDescendants=function(d){J(this,d||document.getElementById(this.currentSceneId()))};a.refreshElement=function(d){q(this,d)};a.disableChangeObserver=function(){x(this)};a.enableChangeObserver=function(){u(this)};a.setContentIfNecessary=function(d,e){d.innerHTML!=e&&(d.innerHTML=e)};p||
(I(a,b),u(a))}var p=-1!=window.location.href.indexOf("/Hype/Scratch/HypeScratch."),z={},n={},f={source:"shared",fallbackImage:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="},handlerMixin:{},sourceRedirect:{},customDataForPreview:{},refreshOnSetData:!0,forceRedrawElement:!0,forceRedrawDocument:!1},y=function(a){var b=a.style.display;a.style.display="none";void 0!=a.offsetHeight;a.style.display=b},h={text:{DataMagicPrepareForDisplay:function(a,
b,c){b.innerHTML!=c.data&&H(b)&&(b.innerHTML=c.data)},DataMagicUnload:function(a,b,c){H(b)&&(b.innerHTML="")}},image:{DataMagicPrepareForDisplay:function(a,b,c){"string"==typeof c.data&&(c.data={src:c.data});c.data.src||(c.data.src=b.dataset.fallbackImage||f.fallbackImage());b.innerHTML="";a.getElementProperty(b,"background-image")!=c.data.src&&(b.style.backgroundRepeat="no-repeat",b.style.backgroundPosition=c.data.backgroundPosition||b.dataset.backgroundPosition||"center center",b.style.backgroundSize=
c.data.backgroundSize||b.dataset.backgroundSize||"contain",a.setElementProperty(b,"background-image",c.data.src))},DataMagicUnload:function(a,b,c){a.setElementProperty(b,"background-image","");b.style.backgroundRepeat=b.style.backgroundPosition=""}}};!1==="HYPE_eventListeners"in window&&(window.HYPE_eventListeners=[]);window.HYPE_eventListeners.push({type:"HypeDocumentLoad",callback:L});window.HYPE_eventListeners.push({type:"HypeScenePrepareForDisplay",callback:function(a,b,c){x(a);k(a,b,c)}});window.HYPE_eventListeners.push({type:"HypeSceneLoad",
callback:function(a,b,c){k(a,b,c);u(a)}});window.HYPE_eventListeners.push({type:"HypeSceneUnload",callback:function(a,b,c){x(a)}});if(p){var l=new Proxy({getElementProperty:function(a,b){return a.style.getPropertyValue(b)||null},setElementProperty:function(a,b,c){if(c)switch(b){case "background-image":c="url("+c+")"}a.style.setProperty(b,c,"important")},documentId:function(){return"HypeSceneEditor"}},{get:function(a,b){return"customData"===b?f.customDataForPreview:a[b]}});L(l,document.documentElement);
(new MutationObserver(function(a){a.forEach(function(b){var c=b.target;"attributes"===b.type&&c.parentNode&&"contenteditable"==b.attributeName&&(c.parentNode.hasAttribute("data-magic-key")?"false"==c.getAttribute("contenteditable")&&"true"==b.oldValue?setTimeout(function(){c.parentNode.removeAttribute("magic-edit");q(l,c.parentNode)},1):(c.parentNode.setAttribute("magic-edit","preview"),setTimeout(function(){var d=w(c.parentNode,"data-magic-branch"),e="\x3c!-- Hype Data magic: This is only a preview placeholder and edits are ignored!";
d&&(e+=' This key resides on the branch "'+d+'"');c.innerHTML=e+" --\x3e\n"+c.parentNode.getAttribute("data-magic-key")},1)):c.parentNode.querySelectorAll("[data-magic-key]").length&&("false"==c.getAttribute("contenteditable")&&"true"==b.oldValue?setTimeout(function(){c.parentNode.removeAttribute("magic-edit");c.parentNode.querySelectorAll("[data-magic-key]").forEach(function(d){q(l,d)})},1):(c.parentNode.setAttribute("magic-edit","innerHTML"),setTimeout(function(){c.parentNode.querySelectorAll("[data-magic-key]").forEach(function(d){d.innerHTML=
d.getAttribute("data-magic-key")})},1))))})})).observe(document.documentElement,{attributes:!0,attributeOldValue:!0,attributeFilter:["contenteditable"],subtree:!0});var B;(new MutationObserver(function(a){B||2==a.length&&"HypeMainContentDiv"==a[0].target.id&&(B=setTimeout(function(){B=null;k(l,document.documentElement)},1))})).observe(document.documentElement,{childList:!0,subtree:!0});_updates={};(new MutationObserver(function(a){a.forEach(function(b){var c=b.target.getAttribute(b.attributeName);
if(c&&b.oldValue==c&&-1!=c.indexOf("data-magic")){var d=b.target.getAttribute("hypeobjectid");_updates[d]||(_updates[d]=setTimeout(function(){q(l,b.target);delete _updates[d]},1))}})})).observe(document.documentElement,{attributes:!0,attributeOldValue:!0,attributeFilter:["hypeattributelastkeysplist"],subtree:!0});window.addEventListener("DOMContentLoaded",function(a){document.addEventListener("focusout",function(b){b.target.parentNode.hasAttribute("magic-edit")&&b.target.hasAttribute("contenteditable")&&
(b.target.parentNode.hasAttribute("data-magic-key")?b.target&&(b.target.innerHTML=""):"innerHTML"==b.target.parentNode.getAttribute("magic-edit")&&(b=b.target.querySelectorAll("[data-magic-key]"),b.length&&b.forEach(function(c){c.innerHTML=""})))});document.addEventListener("visibilitychange",function(b){document.hidden||k(l,document.documentElement)},!1);setTimeout(function(){k(l,document.documentElement);I(l,document.documentElement);u(l)},1);document.styleSheets[0].insertRule('[contenteditable="true"] [data-magic-key], [magic-edit="preview"] [contenteditable="true"]  {opacity:0.5}',
0);document.styleSheets[0].insertRule('[magic-edit]::before { position:absolute; opacity:1; content: "Data Magic"; text-align: center; font-size:7px; padding:3px; height: 8px; width: 40px; color:#fff; left: -2px; top: -16px; border-radius: 1px; background-color: #75A4EA;}',0);window.getSelection().removeAllRanges()})}return{version:"1.3.4",setData:function(a,b){b=b||f.source;z[b]=a;1==f.refreshOnSetData&&K()},getData:E,refresh:K,setDefault:function(a,b){f[a]=b},getDefault:function(a){return f[a]},
addDataHandler:function(a,b){if("string"!=!typeof a)switch(typeof b){case "object":h[a]=Object.assign({},f.handlerMixin,b);break;case "function":h[a]=Object.assign({},f.handlerMixin,h.text),h[a].DataMagicPrepareForDisplay=b}},resolveObjectByKey:r,resolveKeyToArray:A}}());
