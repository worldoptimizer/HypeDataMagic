/*
 Hype DataMagic 1.3.7
copyright (c) 2022 Max Ziebell, (https://maxziebell.de). MIT-license
*/
!1==="HypeDataMagic"in window&&(window.HypeDataMagic=function(){function M(a,b,c){if(c.handler)if("()"==c.handler.slice(-2)){if(!n&&a.functions){try{var d=a.functions()[c.handler.slice(0,-2)](a,b,c)}catch(e){console.log('There was an error in your handler "'+c.handler+'": ',e)}return d}}else if("object"==typeof l[c.handler]){if("function"==typeof l[c.handler][c.type]){try{d=l[c.handler][c.type](a,b,c)}catch(e){console.log('There was an error in your handler "'+c.handler+'": ',e)}return d}if(n&&"function"==
typeof l[c.handler].DataMagicPrepareForDisplay){try{d=l[c.handler].DataMagicPrepareForDisplay(a,b,c)}catch(e){console.log('There was an error in your handler "'+c.handler+'": ',e)}return d}}}function A(a,b,c){if(b.getAttribute("data-magic-key")){var d=N(b.getAttribute("data-magic-key")).split(":"),e=d[1]?d[1]:d[0],g=(d[1]?d[0].trim():null)||B(b,"data-magic-source")||f.source,h="customData"==g?a.customData:C(g);if(h)if(h=(d=d[1]?"":B(b,"data-magic-branch"))?q(h,d):h,h=q(h,e),null!=h){if("object"!=
typeof h&&"function"!=typeof h){d=b.getAttribute("data-magic-prefix")||"";var v=b.getAttribute("data-magic-append")||"";if(d||v)h=d+h+v}c=Object.assign({},c,{data:h,source:g,key:e});e=c.type?c.type.replace("HypeScene","DataMagic").split():n?["DataMagicPreviewUpdate"]:["DataMagicPrepareForDisplay","DataMagicLoad"];var U=(b.getAttribute("data-magic-handler")||f.handler).split(",");e.forEach(function(V){var O;U.forEach(function(W){O=M(a,b,Object.assign({},c,O,{type:V,handler:W.trim()}))})})}else w(a,
b)}}function w(a,b,c){c=Object.assign({},c);handlers=(c.oldHandler||b.getAttribute("data-magic-handler")||f.handler).split(",");var d;handlers.forEach(function(e){d=M(a,b,Object.assign({},c,d,{type:"DataMagicUnload",handler:e.trim()}))})}function P(a){return!a.querySelectorAll(".HYPE_element, .HYPE_element_container").length}function Q(a,b){p[a.documentId()]||(p[a.documentId()]={changeObserver:new MutationObserver(function(c){c.forEach(function(d){if("attributes"==d.type){var e=d.target,g=d.attributeName,
h=N(e.getAttribute(g));d=d.oldValue;if(h!=d)switch(g){case "data-magic-key":h?A(a,e):w(a,e);break;case "data-magic-source":case "data-magic-branch":w(a,e);k(a,e);break;case "data-magic-handler":w(a,e,{oldHandler:d});k(a,e);break;case "data-magic-prefix":case "data-magic-append":k(a,e)}}})}),options:{subtree:!0,attributes:!0,attributeFilter:"data-magic-key data-magic-source data-magic-branch data-magic-handler data-magic-prefix data-magic-append".split(" "),attributeOldValue:!0},enable:function(){this.changeObserver.observe(b,
this.options)},disable:function(){this.changeObserver.disconnect()}})}function x(a){p[a.documentId()]&&p[a.documentId()].enable()}function D(a){p[a.documentId()]&&p[a.documentId()].disable()}function R(a,b,c){b&&b.querySelectorAll("[data-magic-key]").forEach(function(d){A(a,d,c);(f.forceRedrawElement||!n&&f.forceRedrawElementNonIDE)&&E(d)})}function r(a,b,c){b&&(A(a,b,c),(1==f.forceRedrawElement||!n&&f.forceRedrawElementNonIDE)&&E(b))}function k(a,b,c){b&&(r(a,b,c),R(a,b,c),(1==f.forceRedrawDocument||
!n&&f.forceRedrawDocumentNonIDE)&&E(b))}function S(a){a&&a.hasOwnProperty("refresh")?a.refresh():window.hasOwnProperty("HYPE")&&Object.values(window.HYPE.documents).forEach(function(b){b.refresh()})}function C(a,b){if(f.sourceRedirect[a])return F[f.sourceRedirect[a]]||null;a||(a=f.source);var c=F[a]||null;return c&&b?q(c,b):c}function N(a){if("string"==typeof a)return a.trim()}function G(a){if(Array.isArray(a))return a.reduce(function(b,c){return b.concat(G(c))},[]);if("string"==typeof a)return a=
a.replace(/\[(\d+)\]/g,function(b,c){return"."+parseInt(c)}),a=a.replace(/^\./,""),a.split(".")}function q(a,b){if("object"==typeof a){for(var c=G(b),d=a,e=0;void 0!==d&&e<c.length;)d=d[c[e]],f.allowDataFunctions&&"function"===typeof d&&(d=d()),e++;return d}}function t(a,b,c){"object"===typeof a?(c||(a=H(a)),Object.keys(a).forEach(function(d){a[d]=t(a[d],b,!0)})):"function"===typeof a?a[key]=t(a[key](),b,!0):"string"===typeof a&&(a=y(a,b));return a}function y(a,b){if("string"===typeof a){var c=a.match(/\${.*?}|%{.*?}|\u2728{.*?}/g);
c&&c.forEach(function(d){var e=d.replace(/\$\{|%\{|\u2728\{|\}|\(\)/g,"").split(":"),g=e[1]?e[1]:e[0];e=e[1]?C(e[0].trim()):null;g=q(e||b,g);a=a.replace(d,g)})}return a}function H(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor(),c;for(c in a)a.hasOwnProperty(c)&&(b[c]=H(a[c]));return b}function B(a,b){if(!a||!a.id)return null;for(;a.parentNode&&!a.classList.contains("HYPE_scene");){if(a.hasAttribute(b))return a.getAttribute(b);a=a.parentNode}return null}function I(a){var b=Object.assign({},
a.dataset);if(f.allowMagicSets&&b.magicSets)for(var c=b.magicSets.split(","),d=0;d<c.length;){var e=c[d].trim();switch(e){case "parent":(e=a.parentElement.parentElement)&&z(b,e.dataset);break;case "parents":for(e=a.parentElement;e&&!e.classList.contains("HYPE_scene");)z(b,e.dataset),e=e.parentElement;break;default:0===e.indexOf("closest(")&&e.indexOf(")")===e.length-1?(e=e.substring(8,e.length-1),(e=a.closest(e))&&z(b,e.dataset)):document.querySelectorAll(e).forEach(function(g){z(b,g.dataset)})}d++}return b}
function z(a,b){for(var c in b)a.hasOwnProperty(c)||(a[c]=b[c])}function J(a,b){if(a.__isReactive)return a;var c=new Proxy(a,{get:function(d,e,g){d=Reflect.get(d,e,g);return"object"===typeof d?J(d,b):d},set:function(d,e,g,h){var v=Reflect.set(d,e,g,h);"__isReactive"!==e&&b(e,g,d,h);return v}});Object.defineProperty(c,"__isReactive",{value:!0,enumerable:!1,configurable:!1});return c}function K(a){if(!a.__isReactive)return a;var b={},c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];"object"===typeof d?
b[c]=K(d):"__isReactive"!==c&&(b[c]=d)}return b}function u(a){return function(){if(!a.timeout){var b=arguments;a.timeout=requestAnimationFrame(function(){a.apply(this,b);a.timeout=null}.bind(this))}}}function T(a,b,c){a.refresh=function(d){k(this,d||document.getElementById(this.currentSceneId()))};a.refreshDebounced=u(a.refresh);a.refreshDescendants=function(d){R(this,d||document.getElementById(this.currentSceneId()))};a.refreshDescendantsDebounced=u(a.refreshDescendants);a.refreshElement=function(d){r(this,
d)};a.refreshElementDebounced=u(a.refreshElement);a.disableChangeObserver=function(){D(this)};a.enableChangeObserver=function(){x(this)};a.setContentIfNecessary=function(d,e){d.innerHTML!=e&&(d.innerHTML=e)};a.enableReactiveCustomData=function(){a.customData=J(a.customData,f.reactiveCustomDataHandler||function(d,e){a._refreshRequested||(a._refreshRequested=!0,requestAnimationFrame(function(){a._refreshRequested=!1;a.refresh()}))})};a.disableReactiveCustomData=function(){a.customData=K(a.customData)};
f.customData&&(a.customData=f.customData);f.refreshOnCustomData&&a.enableReactiveCustomData();n||(Q(a,b),x(a))}var n=-1!=window.location.href.indexOf("/Hype/Scratch/HypeScratch."),F={},p={},f={source:"shared",fallbackImage:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="},handler:"text",variables:null,handlerMixin:{},sourceRedirect:{},refreshOnSetData:!0,refreshOnCustomData:!0,forceRedrawElement:!1,forceRedrawElementNonIDE:!1,
forceRedrawDocument:!1,forceRedrawDocumentNonIDE:!1,highlightDataMagic:!0,allowDataFunctions:!0,allowVariables:!0,allowDatasets:!0,allowMagicSets:!0,resourcesFolderNameForPreview:""},E=function(a){var b=a.style.display;a.style.display="none";void 0!=a.offsetHeight;a.style.display=b},l={text:{DataMagicPrepareForDisplay:function(a,b,c){b.innerHTML!=c.data&&P(b)&&(f.allowVariables&&(c.data=y(c.data,Object.assign({},f.variables||a.customData,{resourcesFolderName:a.resourcesFolderURL()},b&&f.allowDatasets?
{dataset:I(b)}:null))),b.innerHTML=c.data)},DataMagicUnload:function(a,b,c){P(b)&&(b.innerHTML="")}},variables:{DataMagicPrepareForDisplay:function(a,b,c){f.allowVariables&&(c.data=y(c.data,f.variables||a.customData));return c}},dataset:{DataMagicPrepareForDisplay:function(a,b,c){b&&f.allowDatasets&&(c.data=t(c.data,{dataset:I(b)}));return c}},image:{DataMagicPrepareForDisplay:function(a,b,c){"string"==typeof c.data&&(c.data={src:c.data});c.data.src||(c.data.src=b.dataset.fallbackImage||f.fallbackImage());
f.allowVariables&&(c.data=t(c.data,Object.assign({},f.variables||a.customData,{resourcesFolderName:a.resourcesFolderURL()},b&&f.allowDatasets?{dataset:I(b)}:null)));b.innerHTML="";a.getElementProperty(b,"background-image")!=c.data.src&&(b.style.backgroundRepeat="no-repeat",b.style.backgroundPosition=c.data.backgroundPosition||b.dataset.backgroundPosition||"center center",b.style.backgroundSize=c.data.backgroundSize||b.dataset.backgroundSize||"contain",a.setElementProperty(b,"background-image",c.data.src))},
DataMagicUnload:function(a,b,c){a.setElementProperty(b,"background-image","");b.style.backgroundRepeat=b.style.backgroundPosition=""}}};u(k);!1==="HYPE_eventListeners"in window&&(window.HYPE_eventListeners=[]);window.HYPE_eventListeners.push({type:"HypeDocumentLoad",callback:T});window.HYPE_eventListeners.push({type:"HypeScenePrepareForDisplay",callback:function(a,b,c){D(a);k(a,b,c)}});window.HYPE_eventListeners.push({type:"HypeSceneLoad",callback:function(a,b,c){k(a,b,c);x(a)}});window.HYPE_eventListeners.push({type:"HypeSceneUnload",
callback:function(a,b,c){D(a)}});if(n){var m=new Proxy({getElementProperty:function(a,b){return a.style.getPropertyValue(b)||null},setElementProperty:function(a,b,c){if(c)switch(b){case "background-image":c="url("+c+")"}a.style.setProperty(b,c,"important")},documentId:function(){return"HypeSceneEditor"},resourcesFolderURL:function(){return f.resourcesFolderNameForPreview||window.location.href.replace(/\/$/,"")}},{get:function(a,b){return"customData"===b?f.customDataForPreview||f.customData||{}:a[b]}});
T(m,document.documentElement);(new MutationObserver(function(a){a.forEach(function(b){var c=b.target;"attributes"===b.type&&c.parentNode&&"contenteditable"==b.attributeName&&(c.parentNode.hasAttribute("data-magic-key")?"false"==c.getAttribute("contenteditable")&&"true"==b.oldValue?setTimeout(function(){c.parentNode.removeAttribute("magic-edit");r(m,c.parentNode)},1):(c.parentNode.setAttribute("magic-edit","preview"),setTimeout(function(){var d=B(c.parentNode,"data-magic-branch"),e="\x3c!-- Hype Data magic: This is only a preview placeholder and edits are ignored!";
d&&(e+=' This key resides on the branch "'+d+'"');c.innerHTML=e+" --\x3e\n"+c.parentNode.getAttribute("data-magic-key")},1)):c.parentNode.querySelectorAll("[data-magic-key]").length&&("false"==c.getAttribute("contenteditable")&&"true"==b.oldValue?setTimeout(function(){c.parentNode.removeAttribute("magic-edit");c.parentNode.querySelectorAll("[data-magic-key]").forEach(function(d){r(m,d)})},1):(c.parentNode.setAttribute("magic-edit","innerHTML"),setTimeout(function(){c.parentNode.querySelectorAll("[data-magic-key]").forEach(function(d){d.innerHTML=
d.getAttribute("data-magic-key")})},1))))})})).observe(document.documentElement,{attributes:!0,attributeOldValue:!0,attributeFilter:["contenteditable"],subtree:!0});var L;(new MutationObserver(function(a){L||2==a.length&&"HypeMainContentDiv"==a[0].target.id&&(L=setTimeout(function(){L=null;k(m,document.documentElement)},1))})).observe(document.documentElement,{childList:!0,subtree:!0});_updates={};(new MutationObserver(function(a){a.forEach(function(b){var c=b.target.getAttribute(b.attributeName);
if(c&&b.oldValue==c&&-1!=c.indexOf("data-magic")){var d=b.target.getAttribute("hypeobjectid");_updates[d]||(_updates[d]=setTimeout(function(){r(m,b.target);delete _updates[d]},1))}})})).observe(document.documentElement,{attributes:!0,attributeOldValue:!0,attributeFilter:["hypeattributelastkeysplist"],subtree:!0});window.addEventListener("DOMContentLoaded",function(a){document.addEventListener("focusout",function(b){b.target.parentNode.hasAttribute("magic-edit")&&b.target.hasAttribute("contenteditable")&&
(b.target.parentNode.hasAttribute("data-magic-key")?b.target&&(b.target.innerHTML=""):"innerHTML"==b.target.parentNode.getAttribute("magic-edit")&&(b=b.target.querySelectorAll("[data-magic-key]"),b.length&&b.forEach(function(c){c.innerHTML=""})))});document.addEventListener("visibilitychange",function(b){document.hidden||k(m,document.documentElement)},!1);setTimeout(function(){k(m,document.documentElement);Q(m,document.documentElement);x(m)},1);a=f.highlightDataMagic?"[data-magic-key]::before":"[magic-edit]::before";
document.styleSheets[0].insertRule('[contenteditable="true"] [data-magic-key], [magic-edit="preview"] [contenteditable="true"]  {opacity:0.5}',0);document.styleSheets[0].insertRule(a+' {position: absolute; content: "Data Magic";  z-index: 10; top: -16px; left: 0px; height: 15px; display: flex; align-items: center; justify-content: center; font: 8px Arial; color: white; background: #75A4EA; border-top-right-radius: 0.2rem; border-top-left-radius: 0.2rem; padding: 0.5rem; box-sizing: border-box;}',
0);f.highlightDataMagic&&document.styleSheets[0].insertRule('[data-magic-key]:after {content: " "; position: absolute; z-index: -1; top: 0px; left: 0px; right: 0px; bottom: 0px; border: 1px solid #75A4EA;}',0);window.getSelection().removeAllRanges()})}return{version:"1.3.7",setData:function(a,b){b=b||f.source;F[b]=a;1==f.refreshOnSetData&&S()},getData:C,refresh:S,setDefault:function(a,b){f[a]=b},getDefault:function(a){return f[a]},addDataHandler:function(a,b){if("string"!=!typeof a)switch(typeof b){case "object":l[a]=
Object.assign({},f.handlerMixin,b);break;case "function":l[a]=Object.assign({},f.handlerMixin,l.text),l[a].DataMagicPrepareForDisplay=b}},resolveObjectByKey:q,resolveKeyToArray:G,resolveVariablesInString:y,resolveVariablesInObject:t,cloneObject:H,enableReactiveObject:J,disableReactiveObject:K,createSequence:function(a,b,c,d){b=b||0;var e=[];a.forEach(function(g){if(Array.isArray(g))for(var h=0;h<g[0];h++)e.push(g[1]);else e.push(g)});return function(g){g=void 0==g?0:g;"string"===typeof g&&(b=g=parseInt(g));
b>=e.length&&(b%=e.length);0>b&&(b=e.length+b%e.length);var h=e[b];b+=g;"function"===typeof h&&(h=h());switch(typeof c){case "function":c(h);break;case "object":d&&(object[d]=h)}return h}},debounceByRequestFrame:u}}());
